
# Агрегатор CRUD действий пользователей

Этот проект представляет собой приложение для пакетной обработки потоков данных и вычисления агрегированных показателей по CRUD действиям пользователей за последние 7 дней. Приложение читает данные из логов, расположенных в формате CSV файлов, и сохраняет результат в виде агрегированного файла в директорию `output`.



### Формат входных данных

Каждый CSV файл в директории `input` представляет собой логи действий пользователей за один день. 

Для генерации логов можно воспользоваться скриптом `generate.py`.
```bash
python3 generate.py <dir to put files> <%Y-%m-%d date> <days_count> <unique emails count> <events count>
```
Например:
```bash
python3 generate.py input 2024-09-10 30 10 2000
```

**Формат входного файла:**
- **email**: Email пользователя
- **action**: Одно из действий — CREATE, READ, UPDATE, DELETE
- **dt**: Дата и время выполнения действия в формате `YYYY-mm-dd HH:MM:SS`

**Пример входных данных в CSV:**
```
BYWDBz@ya.ru,DELETE,2024-09-10 16:01:32
RssCui@mail.ru,CREATE,2024-09-10 00:03:34
BYWDBz@ya.ru,DELETE,2024-09-10 19:49:59
GTeZH@mail.ru,UPDATE,2024-09-10 05:23:02
kHpHM@ya.ru,READ,2024-09-10 20:37:38
```

### Формат выходных данных

Файл с результатом агрегирования создается в директории `output` с именем по шаблону `YYYY-mm-dd.csv` (например, `2024-09-16.csv`). Он содержит суммарное количество CRUD действий каждого пользователя за последние 7 дней до указанной даты. То есть файл `2024-09-16.csv` содержит агрегат действий по пользователям от 2024-09-09 до 2024-09-15 включительно.

**Структура выходного CSV файла:** `email`, `create_count`, `read_count`, `update_count`, `delete_count`.

**Пример выходных данных в CSV:**
```
email,create_count,read_count,update_count,delete_count
AjdIjF@mail.ru,362,322,370,344
BYWDBz@ya.ru,348,340,346,365
FEXVfhXnUNAV@mail.ru,369,370,346,326
```


## Использование

Для работы проекта требуется Python версии 3.6 и выше, а также библиотека `pandas`.

### Шаги для установки:

1. Склонируйте репозиторий или скачайте проект:

    ```bash
    git clone --branch simple https://github.com/lampedusa238/crud-aggregator.git
    ```

2. Установите необходимые зависимости:

    ```bash
    pip install -r requirements.txt
    ```


### Пример использования:
Для запуска скрипта необходимо передать дату в формате `YYYY-mm-dd`, за которую нужно выполнить агрегацию.

```bash
python script.py 2024-09-16
```

Этот вызов создаст файл с агрегированными данными в папке output, который будет содержать информацию о действиях пользователей за 7 предыдущих дней (с 2024-09-09 по 2024-09-15).